{
  "üß¨ TRAJECTORY_HUB_DNA_v2": {
    "version": "2.0",
    "fecha": "2025-07-09T16:16:50.574251",
    "inmutable": true,
    "‚ö†Ô∏è INSTRUCCIONES_CRITICAS": [
      "ESTE DOCUMENTO ES LA VERDAD ABSOLUTA DEL PROYECTO",
      "DEBE SER LO PRIMERO QUE SE CARGUE EN CADA SESI√ìN",
      "NING√öN CAMBIO SIN ACTUALIZAR ESTE DOCUMENTO",
      "TODOS LOS FIXES DEBEN RESPETAR ESTA ARQUITECTURA"
    ],
    "üìä ESTADO_ACTUAL_REAL": {
      "flujo_creacion_macros": {
        "inicio": "CLI Interface",
        "pasos": [
          {
            "componente": "Engine",
            "accion": "Recibe create_macro con par√°metros",
            "detalles": "Par√°metros:          self,          name: str,          source_count: int,          behavior: str = \"flock\",         formation: str = \"circle\",         spacing: float = 2.0,         **kwargs     ) -> str:         # CORRECCI√ìN: Flexibilidad para source_count         if isinstance(source_count, list",
            "problema": "Recibe 'formation' y calcula internamente"
          },
          {
            "componente": "Engine",
            "accion": "Calcula formaciones internamente",
            "problema": "VIOLA arquitectura - deber√≠a solo aplicar posiciones"
          }
        ],
        "problemas": []
      },
      "responsabilidades": {
        "CLI Interface": {
          "metodos": 15,
          "responsabilidades": [
            "Muestra UI"
          ],
          "viola_arquitectura": []
        },
        "Interactive Controller": {
          "metodos": 39,
          "responsabilidades": [
            "Crea macros",
            "Muestra UI",
            "Procesa comandos"
          ],
          "viola_arquitectura": []
        },
        "Command Processor": {
          "metodos": 12,
          "responsabilidades": [
            "Crea macros"
          ],
          "viola_arquitectura": []
        },
        "Formation Manager": {
          "metodos": 1,
          "responsabilidades": [
            "Calcula formaciones"
          ],
          "viola_arquitectura": []
        },
        "Engine": {
          "metodos": 54,
          "responsabilidades": [
            "Crea macros",
            "Calcula formaciones",
            "Env√≠a OSC"
          ],
          "viola_arquitectura": [
            "No deber√≠a calcular formaciones"
          ]
        },
        "OSC Bridge": {
          "metodos": 52,
          "responsabilidades": [
            "Env√≠a OSC"
          ],
          "viola_arquitectura": []
        }
      }
    },
    "üéØ ESTADO_OBJETIVO": {
      "principios": [
        "SEPARACI√ìN ESTRICTA DE RESPONSABILIDADES",
        "FLUJO UNIDIRECCIONAL DE DATOS",
        "NING√öN COMPONENTE HACE TODO",
        "TESTABILIDAD COMPLETA"
      ],
      "flujo_correcto": {
        "1": "Usuario interact√∫a con UI (CLI/Interactive/MCP/Gestos)",
        "2": "UI crea SemanticCommand",
        "3": "CommandProcessor interpreta comando",
        "4": "CommandProcessor usa FormationManager para calcular",
        "5": "CommandProcessor pasa positions[] a Engine",
        "6": "Engine aplica positions y env√≠a OSC",
        "7": "UI muestra resultado"
      },
      "responsabilidades_estrictas": {
        "CLI Interface": [
          "Capturar input",
          "Mostrar output",
          "Crear comandos"
        ],
        "Interactive Controller": [
          "Navegaci√≥n men√∫s",
          "Display",
          "MAX 25 m√©todos"
        ],
        "Command Processor": [
          "TODA la l√≥gica",
          "Orquestar",
          "Validar"
        ],
        "Formation Manager": [
          "Calcular formaciones",
          "Nada m√°s"
        ],
        "Engine": [
          "Aplicar positions",
          "Gestionar sources",
          "Enviar OSC"
        ],
        "OSC Bridge": [
          "Comunicaci√≥n OSC",
          "Nada de l√≥gica"
        ]
      }
    },
    "‚ùå VIOLACIONES_ACTUALES": [
      {
        "tipo": "CR√çTICO",
        "componente": "Engine",
        "problema": "Calcula formaciones internamente en lugar de recibirlas",
        "impacto": "Imposible a√±adir formaciones sin modificar Engine",
        "solucion": "Engine.create_macro debe recibir positions[], no formation string"
      },
      {
        "tipo": "ALTO",
        "componente": "CLI Interface",
        "problema": "Llama directamente a Engine sin pasar por CommandProcessor",
        "impacto": "L√≥gica dispersa, dif√≠cil mantener",
        "solucion": "Todo debe pasar por CommandProcessor"
      },
      {
        "tipo": "MEDIO",
        "componente": "Interactive Controller",
        "problema": "122 m√©todos cuando deber√≠a tener m√°ximo 25",
        "impacto": "Dif√≠cil de mantener y testear",
        "solucion": "Refactorizar delegando l√≥gica a CommandProcessor"
      }
    ],
    "üõ†Ô∏è ROADMAP_MIGRACION": [
      {
        "fase": 1,
        "nombre": "Fix Sphere (temporal)",
        "tareas": [
          "Hacer que Engine use FormationManager para sphere",
          "Verificar que OSC env√≠e x,y,z"
        ],
        "tiempo": "30 minutos",
        "impacto": "BAJO"
      },
      {
        "fase": 2,
        "nombre": "Refactorizar create_macro",
        "tareas": [
          "Cambiar Engine.create_macro para recibir positions[]",
          "Mover c√°lculo de formaciones a CommandProcessor",
          "Actualizar todos los llamadores"
        ],
        "tiempo": "2-3 horas",
        "impacto": "ALTO"
      },
      {
        "fase": 3,
        "nombre": "Implementar CommandProcessor completo",
        "tareas": [
          "Crear SemanticCommand class",
          "Implementar interpretaci√≥n de comandos",
          "Conectar UI ‚Üí CommandProcessor ‚Üí Engine"
        ],
        "tiempo": "1 d√≠a",
        "impacto": "ALTO"
      },
      {
        "fase": 4,
        "nombre": "Refactorizar Interactive Controller",
        "tareas": [
          "Extraer l√≥gica a CommandProcessor",
          "Reducir a 25 m√©todos",
          "Solo navegaci√≥n y display"
        ],
        "tiempo": "2 d√≠as",
        "impacto": "MEDIO"
      }
    ],
    "üìã REGLAS_INMUTABLES": {
      "1": "Engine NUNCA calcula formaciones, solo aplica positions",
      "2": "TODO pasa por CommandProcessor",
      "3": "Interactive Controller m√°ximo 25 m√©todos",
      "4": "FormationManager solo calcula, no ejecuta",
      "5": "OSC Bridge solo transmite, no procesa"
    },
    "üîß PARA_ARREGLAR_SPHERE": {
      "problema": "Engine calcula sphere como circle (2D)",
      "solucion_temporal": "Hacer que Engine use FormationManager",
      "solucion_correcta": "Refactorizar flujo completo",
      "comando": "python fix_sphere_respecting_current_architecture.py"
    },
    "üíæ PRESERVAR_ENTRE_SESIONES": [
      "Este DNA completo",
      "Estado de refactorizaci√≥n",
      "Problemas pendientes",
      "Decisiones arquitect√≥nicas"
    ]
  }
}